import React, { useEffect, useRef, useState } from 'react';
import styled from 'styled-components';
declare var H5P: any;

import AudioPlayer from '../AudioPlayer/AudioPlayer'
import svgatorInit from './svgator';
import {
    ClapJumpingPirate,
    JumpingPirate,
    JumpingPirateV2,
    SurprisedPirate,
    ThumbsUpPirate,
} from './animations/';

const feedbackAnimations = ['pirate-jump', 'pirate-jump-clap', 'pirate-thumbsup', 'pirate-jump-v2']

const timeoutValue: number = 2500;
let animationEndTimeout: ReturnType<typeof setTimeout>;

const StandingPirate = () => (
    <svg id="pirate-cheering" xmlns="http://www.w3.org/2000/svg"
        xmlnsXlink="http://www.w3.org/1999/xlink"
        viewBox="0 0 800 883"
        shapeRendering="geometricPrecision"
        textRendering="geometricPrecision"
    >
        <g id="pirate-cheering-legs">
            <path id="pirate-cheering-left-leg" d="M236.98,842.24C236.98,842.24,243.14,747.87,243.14,747.87" transform="matrix(1 0 0 1 79.03 0)" fill="none" stroke="rgb(61,60,63)" strokeWidth="9" strokeMiterlimit="10"/>
            <path id="pirate-cheering-right-leg" d="M340.07,842.24C340.07,842.24,333.91,747.87,333.91,747.87" transform="matrix(1 0 0 1 79.03 0)" fill="none" stroke="rgb(61,60,63)" strokeWidth="9" strokeMiterlimit="10"/>
            <path id="pirate-cheering-path1" d="M241.33,841.11C244.41,831.86,198.7,816.75,185.33,841.11C171.96,865.47,236.46,855.72,241.33,841.11Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(61,60,63)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-path2" d="M335.72,844.11C332.64,834.86,378.35,819.75,391.72,844.11C405.09,868.47,340.59,858.72,335.72,844.11Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(61,60,63)" stroke="none" strokeWidth="1"/></g><g id="pirate-cheering-upper-body"><g id="pirate-cheering-layer-6"><polygon id="pirate-cheering-polygon1" points="168.585601,585.691979 136,449 196.079702,449 317.298139,474.099661 427.23381,449 447.599811,462.992092 441.490011,524.342036 418.06911,592.149868 343.733207,622.286682 246.994704,630.8972 168.585601,585.691979" transform="matrix(1 0 0 1 79.186316 0.016634)" fill="rgb(59,16,15)" stroke="none" strokeWidth="1"/></g><path id="pirate-cheering-path3" d="M142.47,520.72C142.47,520.72,42.47,578.72,37.47,628.72C32.47,678.72,214.47,676.72,214.47,676.72" transform="matrix(1 0 0 1 79.03 0)" fill="none" stroke="rgb(61,60,63)" strokeWidth="9" strokeMiterlimit="10"/><g id="pirate-cheering-right-hand"><path id="pirate-cheering-arm" d="M452.5,520.5C452.291733,520.77769,681.47,693.640504,393.524078,676.72" transform="matrix(1 0 0 1 79.03 0)" fill="none" stroke="rgb(61,60,63)" strokeWidth="9" strokeMiterlimit="10"/><g id="pirate-cheering-hand" transform="matrix(-0.485293 0.874352 0.874352 0.485293 436.329039 -123.150992)"><path id="pirate-cheering-path4" d="M652.56,311.89C652.56,311.89,634.47,287.72,642.47,279.72C650.47,271.72,657.47,279.72,659.47,291.72C661.47,303.72,668.47,321.72,668.47,321.72Z" transform="matrix(1 0 0 1 38.352673 69.100021)" fill="rgb(61,60,63)" stroke="none" strokeWidth="1"/><g id="pirate-cheering-g1"><path id="pirate-cheering-path5" d="M662.47,309.72C652.63,304.81,629.47,297.72,624.47,305.72C619.47,313.72,626.76,396.43,671.71,362.79C678.47,357.72,678.47,317.72,662.47,309.72Z" transform="matrix(1 0 0 1 38.352673 69.100021)" fill="rgb(61,60,63)" stroke="none" strokeWidth="1"/><g id="pirate-cheering-g2" clipPath="url(#pirate-cheering-clipPath-3)"><g id="pirate-cheering-g3"><path id="pirate-cheering-path6" d="M657.83,306.71C657.83,306.71,680.47,373.71,628.47,355.71L640.47,373.71L662.47,370.79L681.47,356.71L670.47,308.71L657.83,306.71" transform="matrix(1 0 0 1 38.352673 69.100021)" fill="rgb(37,37,38)" stroke="none" strokeWidth="1"/></g><clipPath id="pirate-cheering-clipPath-3"><path id="pirate-cheering-path7" d="M662.47,309.72C652.63,304.81,629.47,297.72,624.47,305.72C619.47,313.72,626.76,396.43,671.71,362.79C678.47,357.72,678.47,317.72,662.47,309.72Z" transform="matrix(1 0 0 1 38.352673 69.100021)" fill="rgb(61,60,63)" stroke="none" strokeWidth="1"/></clipPath></g></g></g></g><g id="pirate-cheering-mouth"><path id="pirate-cheering-tounge" d="M225,592.22C225,592.22,249,564.22,294,565.22C339,566.22,366,592.22,366,592.22C366,592.22,293,633.22,225,592.22Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(232,40,44)" stroke="none" strokeWidth="1"/><g id="pirate-cheering-tounge-sh" transform="matrix(1 0 0 1 -13.87077 -9.133362)" clipPath="url(#pirate-cheering-clipping-paths)"><path id="pirate-cheering-path8" d="M247.15102,590.731039Q314.916626,610.891133,352.603569,598.28086Q390.290512,585.670587,286.969999,577.23764Q248.832041,590.73104,247.15102,590.731039Z" transform="matrix(1 0 0 1 79.030001 0.000001)" fill="rgb(203,14,18)" stroke="rgb(63,87,135)" strokeWidth="0"/><clipPath id="pirate-cheering-clipping-paths"><path id="pirate-cheering-copy-of-tounge" d="M225,592.22C225,592.22,249,564.22,294,565.22C339,566.22,366,592.22,366,592.22C366,592.22,293,633.22,225,592.22Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(232,40,44)" stroke="none" strokeWidth="1"/></clipPath></g><polygon id="pirate-cheering-polygon2" points="178.97,464.22 190.97,513.22 224.97,477.22 178.97,464.22" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(255,255,255)" stroke="none" strokeWidth="1"/><polygon id="pirate-cheering-polygon3" points="238.97,480.22 256.97,520.22 286.97,484.22 238.97,480.22" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(255,255,255)" stroke="none" strokeWidth="1"/><polygon id="pirate-cheering-polygon4" points="309.97,489.22 332.97,520.22 354.97,482.22 309.97,489.22" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(255,255,255)" stroke="none" strokeWidth="1"/><polygon id="pirate-cheering-polygon5" points="365.97,480.22 399.97,506.22 412.97,468.22 365.97,480.22" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(255,255,255)" stroke="none" strokeWidth="1"/><g id="pirate-cheering-g4"><path id="pirate-cheering-moth-to-animate" d="M483,450C471,383,366.25,268,298,268C235.12,268,134.82,388.53,117,454C101.6,510.58,171.53,717.28,195,741C218.47,764.72,367.78,761.3,389.77,728.67C411.76,696.04,489.32,485.29,483,450ZM402,559.22C395.59,570.3,345.56,605.13,291,606.22C251.94,607.01,210.65,581.46,181,559.22C169,550.22,172.527286,546.22,172.527286,546.22C172.527286,546.22,275.47,617.329771,406.47,552.329771C408.775548,551.956464,408.608583,551.953967,402,559.22Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(67,158,255)" stroke="none" strokeWidth="1"/><g id="pirate-cheering-g5" clipPath="url(#pirate-cheering-clipPath-4)"><g id="pirate-cheering-g6"><path id="pirate-cheering-path9" d="M109.47,479.72C109.47,479.72,171.47,456.72,214.47,390.72C257.47,324.72,295.090477,312.441755,364.54,358.015577C506.617626,453.671827,394.199201,623.789641,274.47,685.72C191,728,164.47,708.72,164.47,708.72L172,780L411,773L493.47,452.72L452,289L314,241L121,289Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(16,130,232)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-path10" d="M152.47,645.72C148.47,633.72,154.47,600.72,163.47,611.72C172.47,622.72,189.47,649.72,193.47,668.72C197.47,687.72,168.47,696.72,163.47,689.72C158.47,682.72,152.47,645.72,152.47,645.72Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(107,179,255)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-path11" d="M455.13,569C453.47,561.77,435.47,555.77,429.47,565.77C423.47,575.77,414.47,608.77,420.47,613.77C426.47,618.77,443.47,617.77,448.47,611.77C453.47,605.77,455.13,569,455.13,569" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(0,114,217)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-path12" d="M377.47,342.72C365,337,370.47,360.72,377.47,365.72C384.47,370.72,396.94,381.45,408.47,366.72C420,351.99,377.47,342.72,377.47,342.72" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(0,114,217)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-path13" d="M241.47,315.72C262,317,248.47,330.72,242.47,336.72C236.47,342.72,210.64,357.66,207.55,356.72C204.46,355.78,208.65,341.72,208.65,341.72C208.65,341.72,220.94,314.45,241.47,315.72Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(0,114,217)" stroke="none" strokeWidth="1"/></g><clipPath id="pirate-cheering-clipPath-4"><path id="pirate-cheering-path14" d="M483,450C471,383,366.25,268,298,268C235.12,268,134.82,388.53,117,454C101.6,510.58,171.53,717.28,195,741C218.47,764.72,367.78,761.3,389.77,728.67C411.76,696.04,489.32,485.29,483,450ZM402,559.22C395.59,570.3,345.56,605.13,291,606.22C251.94,607.01,210.65,581.46,181,559.22C169,550.22,163,464.22,163,464.22C163,464.22,299,529.22,430,464.22C430,464.22,413,540.22,402,559.22Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(67,158,255)" stroke="none" strokeWidth="1"/></clipPath></g></g><g id="pirate-cheering-body"><path id="pirate-cheering-left-t" d="M208,578C208,578,203,560.22,227,546.22C227,546.22,214,559,238,594C238,594,229.51,590.27,223,587C217.847986,584.260955,212.841281,581.256932,208,578Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(255,255,255)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-right-t" d="M384,575C384,575,388.54,560.22,364.54,546.22C364.54,546.22,380,556,356,591C356,591,369.2,584.17,373,582C376.8,579.83,384,575,384,575Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(255,255,255)" stroke="none" strokeWidth="1"/><g id="pirate-cheering-g7"><path id="pirate-cheering-path15" d="M136.16,524.55C136.48,514.55,137.47,491.72,144.47,493.72C151.47,495.72,160.47,519.72,158.47,528.72C156.47,537.72,135.84,534.39,136.16,524.55Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(107,179,255)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-path16" d="M237.47,626.72C242.32,617.64,263.47,629.72,264.47,634.72C265.47,639.72,229.47,641.72,237.47,626.72Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(107,179,255)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-path17" d="M217.47,438.72C221.47,428.72,230.47,436.72,229.47,443.72C228.47,450.72,211.47,453.72,217.47,438.72Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(107,179,255)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-path18" d="M322.47,467.72C331.47,462.72,337.47,456.72,341.47,467.72C345.47,478.72,328.47,484.72,319.47,482.72C310.47,480.72,313.47,472.72,322.47,467.72Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(107,179,255)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-path19" d="M220.47,685.72C222.86,674.58,239.47,665.72,245.47,670.72C251.47,675.72,248.47,685.72,239.47,688.72C230.47,691.72,217.47,699.72,220.47,685.72Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(107,179,255)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-path20" d="M317.47,659.72C321.14,653.44,332.47,645.72,339.47,648.72C346.47,651.72,350.47,659.72,345.47,664.72C340.47,669.72,310.47,671.72,317.47,659.72Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(0,114,217)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-path21" d="M361.47,618.72C364.11,615.56,373.47,607.72,377.47,610.72C381.47,613.72,381.47,618.72,377.47,623.72C373.47,628.72,356.47,624.72,361.47,618.72Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(0,114,217)" stroke="none" strokeWidth="1"/>
            <path id="pirate-cheering-path22" d="M436.47,518.72C440.47,512.67,449.47,518.72,447.47,520.72C445.47,522.72,432.47,524.72,436.47,518.72Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(0,114,217)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-path23" d="M453.47,478.72C458.47,475.72,466.47,479.72,466.47,484.72C466.47,489.72,453.47,491.72,452.47,488.72C451.47,485.72,453.47,478.72,453.47,478.72Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(0,114,217)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-path24" d="M388.47,419.72C392.47,417.72,400.47,419.72,400.47,424.72C400.47,429.72,386.47,433.72,384.47,431.72C382.47,429.72,388.47,419.72,388.47,419.72Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(0,114,217)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-path25" d="M435,411.28C432.46,415.72,431.46,431.72,436.46,436.72C441.46,441.72,457.46,443.72,462.46,438.72C467.46,433.72,468,419,452,406C436,393,435,411.28,435,411.28" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(0,114,217)" stroke="none" strokeWidth="1"/></g></g></g><g id="pirate-cheering-hat"><path id="pirate-cheering-path26" d="M122,463.22C107,466.22,72,412.65,35,393.22C5.5,377.72,92.84,338.59,160.5,256.72C215.61,190.05,251.2,87.45,310,76.22C378.91,63.07,426.1,191.62,478.5,280.72C525.72,361.02,612.5,403.72,584,410.22C554.74,416.9,487,484.22,474,464.22C461,444.22,367,308.22,299,309.22C231,310.22,157.12,456.19,122,463.22Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(62,60,63)" stroke="none" strokeWidth="1"/><g id="pirate-cheering-g8" clipPath="url(#pirate-cheering-clipPath-5)"><g id="pirate-cheering-g9"><path id="pirate-cheering-path27" d="M90.47,463.72C90.47,463.72,214.47,346.72,232.47,301.72C250.47,256.72,248.47,44.72,406.47,96.72L452.47,176.72L533.47,321.72L608.47,403.72L557.47,448.72L493.47,480.72L452.47,479.72L317,336.45L270.47,336.72L164.47,448.72L104.47,482.72Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(37,37,38)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-path28" d="M33.47,399.72C33.47,399.72,167.47,297.72,201.47,251.72C235.47,205.72,270.47,91.72,323.47,102.72C376.47,113.72,415.47,232.72,435.47,264.72C455.47,296.72,576.47,421.72,576.47,421.72" transform="matrix(1 0 0 1 79.03 0)" fill="none" stroke="rgb(207,191,149)" strokeWidth="3" strokeMiterlimit="10"/><g id="pirate-cheering-g10"><path id="pirate-cheering-path29" d="M364.63,181.42C358.2,166.73,354.52,185.1,354.52,185.1L347.46,191C339.08,184.65,327.46,181.23,316.86,181.44C303.42,181.72,292.3,183.85,284.59,190.17L277.37,185.12C277.37,185.12,274.61,169.5,265.43,181.44C265.43,181.44,249.81,188.79,271.86,189.71L279.09,196.28C276.695391,200.023977,275.020079,204.181734,274.15,208.54C269.56,229.65,289.77,237,289.77,237L271.86,253.08C250.73,254.92,264.51,264.08,264.51,264.08C270.94,276.02,275.51,261.33,275.51,261.33L298.51,242.04C302.56,244.04,301.44,249.82,298.91,255.64C297.4993,258.910589,297.837606,262.672646,299.809176,265.639082C301.780745,268.605517,305.118307,270.374192,308.68,270.34L323.68,270.2C326.695186,270.168438,329.502157,268.656566,331.187654,266.156278C332.873152,263.65599,333.221738,260.486869,332.12,257.68C330.174858,252.53871,329.218095,247.076338,329.3,241.58L353.14,260C353.14,260,353.14,269.18,358.66,270.1C364.18,271.02,363.25,262.75,363.25,262.75C363.25,262.75,370.6,264.59,370.6,259.08C370.6,253.57,360.49,255.4,360.49,255.4L337.49,237.03C337.49,237.03,354.49,231.98,357.7,222.34C361,212.43,358.94,203.98,353.88,197.34L361.83,190.61C381.16,190.61,364.63,181.42,364.63,181.42ZM315,232.86C306.452804,232.864045,298.744971,227.718451,295.471297,219.823032C292.197623,211.927614,294.002947,202.837584,300.045298,196.792373C306.087648,190.747162,315.176822,188.937535,323.07379,192.207471C330.970757,195.477406,336.119999,203.182803,336.12,211.73C336.120001,223.395873,326.665871,232.854479,315,232.86Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(207,191,149)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-path30" d="M315.47,198.72C307.47,198.72,300.58,208.18,300.58,211.72C300.58,215.26,307.05,218.15,315.03,218.15C323.01,218.15,329.47,215.28,329.47,211.72C329.47,208.16,323.45,198.72,315.47,198.72Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(207,191,149)" stroke="none" strokeWidth="1"/></g></g><clipPath id="pirate-cheering-clipPath-5"><path id="pirate-cheering-path31" d="M122,463.22C107,466.22,72,412.65,35,393.22C5.5,377.72,92.84,338.59,160.5,256.72C215.61,190.05,251.2,87.45,310,76.22C378.91,63.07,426.1,191.62,478.5,280.72C525.72,361.02,612.5,403.72,584,410.22C554.74,416.9,487,484.22,474,464.22C461,444.22,367,308.22,299,309.22C231,310.22,157.12,456.19,122,463.22Z" transform="matrix(1 0 0 1 79.03 0)" fill="rgb(62,60,63)" stroke="none" strokeWidth="1"/></clipPath></g></g><g id="pirate-cheering-eye"><path id="pirate-cheering-eye-bg" d="M-54,0C-54,-39.212217,-29.823376,-71,0,-71C29.823376,-71,54,-39.212217,54,0C54,39.212217,29.823376,71,0,71C-29.823376,71,-54,39.212217,-54,0Z" transform="matrix(1 0 0 1 378.5 387.72)" fill="rgb(0,108,188)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-eye-white" d="M-42.42,0C-42.42,-30.927946,-23.427919,-56,0,-56C23.427919,-56,42.42,-30.927946,42.42,0C42.42,30.927946,23.427919,56,0,56C-23.427919,56,-42.42,30.927946,-42.42,0Z" transform="matrix(1 0 0 1 378 393.22)" fill="rgb(255,255,255)" stroke="none" strokeWidth="1"/><ellipse id="pirate-cheering-ellipse1" rx="11.21" ry="14.8" transform="matrix(1 0 0 1 378.37 383.53)" fill="rgb(62,60,63)" stroke="none" strokeWidth="1"/><path id="pirate-cheering-sh-r" d="M252.30365,432.176422Q220.47,442.450226,220.47,452C220.066895,452,251.79,441.466384,262.97,441.611053Q274.15,441.755722,252.30365,432.176422Z" transform="matrix(-0.564177 -0.043782 -0.043782 0.564177 588.738213 184.694614)" opacity="0" fill="rgba(0,108,188,0.29)" stroke="rgb(63,87,135)" strokeWidth="0"/><path id="pirate-cheering-sh-l" d="M252.30365,432.176422Q220.47,442.450226,220.47,452C220.066895,452,251.79,441.466384,262.97,441.611053Q274.15,441.755722,252.30365,432.176422Z" transform="matrix(0.624838 0 0 0.624838 170.818902 148.916822)" opacity="0" fill="rgba(0,108,188,0.29)" stroke="rgb(63,87,135)" strokeWidth="0"/>
            </g>
        </g>
    </svg>
)
const Pirate = (props: any) => {
    const { animate, feedbackAnimation, feedbackAudio } = props;
    const [animation, setAnimation] = useState('none');
    const animationAudio = useRef(feedbackAudio)

    useEffect(() => {
        svgatorInit();
    }, [])

    useEffect(() => {
        clearTimeout(animationEndTimeout);
        if (animate) {
          console.log(props.feedbackAudio);
            if (feedbackAnimation && feedbackAnimation !== 'pirate-random') {
                setAnimation(feedbackAnimation);
            } else {
                setAnimation(feedbackAnimations[Math.floor(Math.random() * 4)]);
            }
            setTimeout(() => animationAudio.current && animationAudio.current.play(), 300);
            animationEndTimeout = setTimeout(props.onAnimationEnd, timeoutValue);
        }
        return () => {
            clearTimeout(animationEndTimeout);
        }
    }, [animate])

    return (
        <>
            { (!animate || animation == 'none') && <StandingPirate /> }

            { animate && animation === 'pirate-jump' && <JumpingPirate />}
            { animate && animation === 'pirate-jump-v2' && <JumpingPirateV2 />}
            { animate && animation === 'pirate-thumbsup' && <ThumbsUpPirate />}
            { animate && animation === 'pirate-jump-clap' && <ClapJumpingPirate />}
            { animate && animation === 'pirate-surprised' && <SurprisedPirate />}
            <audio ref={animationAudio} controls src={props.feedbackAudio} style={{ display: 'none' }} ></audio>
        </>
    );
}

export default Pirate;
